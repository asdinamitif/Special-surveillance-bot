# SOT Bot ‚Äî –¢–µ–ª–µ–≥—Ä–∞–º‚Äë–±–æ—Ç –æ—Ç–¥–µ–ª–∞ –°–û–¢

–ë–æ—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å **–≥—Ä–∞—Ñ–∏–∫–æ–º –≤—ã–µ–∑–¥–æ–≤**, **–∑–∞–º–µ—á–∞–Ω–∏—è–º–∏**, **–û–ù–∑–°** –∏ **–∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π**.
–û—Å–Ω–æ–≤–∞ ‚Äî `python-telegram-bot` + `pandas` + `SQLite`.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üìÖ *–ì—Ä–∞—Ñ–∏–∫* ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ Excel —Å –≥—Ä–∞—Ñ–∏–∫–æ–º –≤—ã–µ–∑–¥–æ–≤, –≤—ã–±–æ—Ä —Å–æ–≥–ª–∞—Å—É—é—â–∏—Ö, —Ü–∏–∫–ª —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è, —Ñ–∏–∫—Å–∞—Ü–∏—è —Ä–µ—à–µ–Ω–∏–π.
- üìä *–ò—Ç–æ–≥–æ–≤–∞—è* ‚Äî –≤—ã–≤–æ–¥ –±–ª–∏–∂–∞–π—à–∏—Ö –≤—ã–µ–∑–¥–æ–≤ –ø–æ –¥–∞–Ω–Ω—ã–º –∏–∑ Excel.
- üìù *–ó–∞–º–µ—á–∞–Ω–∏—è* ‚Äî —Ä–∞–∑–±–æ—Ä —Å—Ç–∞—Ç—É—Å–æ–≤ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –ø–æ —Å—Ç–æ–ª–±—Ü–∞–º Q/R/Y/AD –∏ –∫—Ä–∞—Å–∏–≤—ã–π –≤—ã–≤–æ–¥ –∫–∞—Ä—Ç–æ—á–µ–∫ –æ–±—ä–µ–∫—Ç–æ–≤.
- üèó *–û–ù–∑–°* ‚Äî –≤—ã–±–æ—Ä –û–ù–∑–°, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –¥–∞—Ç–∞–º (–≤–µ—Å—å –∫–æ–¥ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤–Ω—É—Ç—Ä–∏ `bot.py`).
- üìà *–ê–Ω–∞–ª–∏—Ç–∏–∫–∞* ‚Äî –¥–æ—Å—Ç—É–ø –ø–æ –ø–∞—Ä–æ–ª—é, –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –ø–æ –ë–î (—Ç–∞–±–ª–∏—Ü—ã `approvals`, `schedule_files`, `users` –∏ —Ç.–¥.).

> –í–µ—Å—å –±–∏–∑–Ω–µ—Å‚Äë–∫–æ–¥ —É —Ç–µ–±—è —É–∂–µ –≤–Ω—É—Ç—Ä–∏ `bot.py` ‚Äî —è –µ–≥–æ **–Ω–µ —Ç—Ä–æ–≥–∞–ª**, —Ç–æ–ª—å–∫–æ —É–ø–∞–∫–æ–≤–∞–ª –≤ –ø—Ä–æ–µ–∫—Ç —Å Docker –∏ CI/CD.

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```text
.
‚îú‚îÄ‚îÄ bot.py                 # –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥ –±–æ—Ç–∞ (–¢–í–û–Ø –≤–µ—Ä—Å–∏—è)
‚îú‚îÄ‚îÄ requirements.txt       # Python-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ Dockerfile             # –°–±–æ—Ä–∫–∞ Docker-–æ–±—Ä–∞–∑–∞
‚îú‚îÄ‚îÄ docker-compose.yml     # –õ–æ–∫–∞–ª—å–Ω—ã–π/—Å–µ—Ä–≤–µ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ docker-compose
‚îú‚îÄ‚îÄ Procfile               # –î–ª—è Railway/Render/Heroku-–ø–æ–¥–æ–±–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
‚îú‚îÄ‚îÄ .env.example           # –®–∞–±–ª–æ–Ω –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ .gitignore
‚îî‚îÄ‚îÄ .github/
    ‚îî‚îÄ‚îÄ workflows/
        ‚îî‚îÄ‚îÄ ci-cd.yml      # GitHub Actions: —Å–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞ + –¥–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä
```

---

## 1. –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ (–±–µ–∑ Docker)

1. –£—Å—Ç–∞–Ω–æ–≤–∏ Python 3.11+ –∏ Git.
2. –°–∫–ª–æ–Ω–∏—Ä—É–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:

   ```bash
   git clone https://github.com/<—Ç–≤–æ—è-—É—á–µ—Ç–∫–∞>/<—Ç–≤–æ–π-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π>.git
   cd <—Ç–≤–æ–π-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π>
   ```

3. –°–æ–∑–¥–∞–π –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:

   ```bash
   python -m venv .venv
   source .venv/bin/activate      # Linux/macOS
   # .venv\Scripts\activate     # Windows PowerShell
   ```

4. –£—Å—Ç–∞–Ω–æ–≤–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

   ```bash
   pip install -r requirements.txt
   ```

5. –°–æ–∑–¥–∞–π —Ñ–∞–π–ª `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ `.env.example` –∏ –≤–ø–∏—à–∏ **—Ä–µ–∞–ª—å–Ω—ã–π** —Ç–æ–∫–µ–Ω –±–æ—Ç–∞:

   ```bash
   cp .env.example .env
   # –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π BOT_TOKEN, DB_PATH –∏ —Ç.–¥.
   ```

6. –ó–∞–ø—É—Å—Ç–∏ –±–æ—Ç–∞:

   ```bash
   python bot.py
   ```

---

## 2. –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker (–ª–æ–∫–∞–ª—å–Ω–æ –∏–ª–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)

1. –£—Å—Ç–∞–Ω–æ–≤–∏ Docker –∏ docker-compose.
2. –°–∫–æ–ø–∏—Ä—É–π –ø—Ä–æ–µ–∫—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä (–∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É).
3. –°–æ–∑–¥–∞–π `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ `.env.example`:

   ```bash
   cp .env.example .env
   ```

   –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–∫–∞–∂–∏:

   - `BOT_TOKEN` ‚Äî —Ç–æ–∫–µ–Ω Telegram-–±–æ—Ç–∞.
   - `DB_PATH=/app/db/sot_bot.db` (–∫–∞–∫ –≤ `.env.example`).
   - –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–π `TIMEZONE_OFFSET`, `ANALYTICS_PASSWORD`.

4. –ó–∞–ø—É—Å—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:

   ```bash
   docker compose up -d
   ```

–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –±—É–¥–µ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (`restart: unless-stopped`),
–ë–î (`sot_bot.db`) –ª–µ–∂–∏—Ç –≤ –∫–∞—Ç–∞–ª–æ–≥–µ `./db` –Ω–∞ —Ö–æ—Å—Ç–µ.

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å Excel‚Äë—Ñ–∞–π–ª —Å –≥—Ä–∞—Ñ–∏–∫–æ–º —Å —Ö–æ—Å—Ç–∞ –≤–Ω—É—Ç—Ä—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π
—Å—Ç—Ä–æ–∫—É –≤ `docker-compose.yml` –∏ –ø–æ–ª–æ–∂–∏ —Ñ–∞–π–ª —Ä—è–¥–æ–º —Å –Ω–∏–º.

---

## 3. CI/CD –Ω–∞ GitHub (–∞–≤—Ç–æ—Å–±–æ—Ä–∫–∞ Docker-–æ–±—Ä–∞–∑–∞ + –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)

–§–∞–π–ª workflow: `.github/workflows/ci-cd.yml`.

### 3.1. –ß—Ç–æ –¥–µ–ª–∞–µ—Ç pipeline

–ü—Ä–∏ push –≤ –≤–µ—Ç–∫—É `main`:

1. –ó–∞–±–∏—Ä–∞–µ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (`actions/checkout`).
2. –î–µ–ª–∞–µ—Ç –±—ã—Å—Ç—Ä—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–π —á–µ–∫ `bot.py` (`python -m compileall`).
3. –°–æ–±–∏—Ä–∞–µ—Ç Docker-–æ–±—Ä–∞–∑ –∏ –ø—É—à–∏—Ç –µ–≥–æ –≤ GitHub Container Registry (GHCR) –∫–∞–∫:

   ```text
   ghcr.io/<owner>/sot-bot:latest
   ```

4. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —Å–±–æ—Ä–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è job `deploy-to-server`, –∫–æ—Ç–æ—Ä—ã–π –ø–æ SSH –∑–∞—Ö–æ–¥–∏—Ç –Ω–∞ —Ç–≤–æ–π —Å–µ—Ä–≤–µ—Ä,
   –¥–µ–ª–∞–µ—Ç `docker pull` —Å–≤–µ–∂–µ–≥–æ –æ–±—Ä–∞–∑–∞ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç `docker compose` –≤ `/opt/sot-bot`.

### 3.2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GHCR

1. –í–∫–ª—é—á–∏ GitHub Container Registry –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –∞–∫–∫–∞—É–Ω—Ç–∞/–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏.
2. –£–±–µ–¥–∏—Å—å, —á—Ç–æ Actions –º–æ–≥—É—Ç –ø—É—à–∏—Ç—å –≤ GHCR (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `GITHUB_TOKEN` —É–∂–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ).

### 3.3. –°–µ–∫—Ä–µ—Ç—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

–í GitHub ‚Üí Settings ‚Üí Secrets and variables ‚Üí Actions –¥–æ–±–∞–≤—å —Å–µ–∫—Ä–µ—Ç—ã:

- `SSH_HOST` ‚Äî IP –∏–ª–∏ –¥–æ–º–µ–Ω–Ω–æ–µ –∏–º—è —Ç–≤–æ–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞.
- `SSH_USER` ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (–æ–±—ã—á–Ω–æ `root` –∏–ª–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å).
- `SSH_KEY` ‚Äî –ø—Ä–∏–≤–∞—Ç–Ω—ã–π SSH‚Äë–∫–ª—é—á (OpenSSH —Ñ–æ—Ä–º–∞—Ç, –±–µ–∑ passphrase –∏–ª–∏ —Å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º –∞–≥–µ–Ω—Ç–æ–º).
- `SSH_PORT` ‚Äî –ø–æ—Ä—Ç SSH (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 22, –º–æ–∂–Ω–æ –Ω–µ –∑–∞–¥–∞–≤–∞—Ç—å).
- `GHCR_USERNAME` ‚Äî –ª–æ–≥–∏–Ω GitHub (–¥–ª—è –ª–æ–≥–∏–Ω–∞ –Ω–∞ GHCR –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ).
- `GHCR_TOKEN` ‚Äî –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω GitHub —Å –ø—Ä–∞–≤–∞–º–∏ `read:packages`.

### 3.4. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

1. –£—Å—Ç–∞–Ω–æ–≤–∏ Docker –∏ docker-compose.
2. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å–æ–∑–¥–∞–π –∫–∞—Ç–∞–ª–æ–≥ –¥–ª—è –±–æ—Ç–∞:

   ```bash
   sudo mkdir -p /opt/sot-bot
   sudo chown <user>:<user> /opt/sot-bot
   ```

3. –°–∫–æ–ø–∏—Ä—É–π —Ç—É–¥–∞ `docker-compose.yml` –∏ `.env` (–æ–¥–∏–Ω —Ä–∞–∑):

   ```bash
   scp docker-compose.yml .env <user>@<SSH_HOST>:/opt/sot-bot/
   ```

4. –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ (–º–æ–∂–Ω–æ –≤—Ä—É—á–Ω—É—é):

   ```bash
   ssh <user>@<SSH_HOST>
   cd /opt/sot-bot
   docker login ghcr.io -u <GHCR_USERNAME> -p <GHCR_TOKEN>
   docker compose up -d
   ```

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ø—Ä–∏ –∫–∞–∂–¥–æ–º `git push origin main`:

- GitHub Actions —Å–æ–±–µ—Ä—ë—Ç –Ω–æ–≤—ã–π –æ–±—Ä–∞–∑,
- –∑–∞–ø—É—à–∏—Ç –µ–≥–æ –≤ GHCR,
- –∑–∞–π–¥—ë—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä –ø–æ SSH –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç `docker compose` —Å –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–µ–π.

–≠—Ç–æ –∏ –µ—Å—Ç—å —Ç–≤–æ—ë **–∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ / Full DevOps** –¥–ª—è –±–æ—Ç–∞.

---

## 4. Railway / Render / –¥—Ä—É–≥–∏–µ PaaS

–î–ª—è Railway –º–æ–∂–Ω–æ:

1. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç ‚Üí Deploy from GitHub.
2. –£–∫–∞–∑–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å —ç—Ç–∏–º –±–æ—Ç–æ–º.
3. Railway —Å–∞–º –ø—Ä–æ—á–∏—Ç–∞–µ—Ç `Dockerfile` –∏–ª–∏ `Procfile`.
4. –í Variables –¥–æ–±–∞–≤–∏—Ç—å:
   - `BOT_TOKEN`
   - `DB_PATH` (–Ω–∞–ø—Ä–∏–º–µ—Ä `/app/db/sot_bot.db`)
   - –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.

–ü—Ä–∏ –∫–∞–∂–¥–æ–º push –≤ GitHub Railway –±—É–¥–µ—Ç –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞—Ç—å –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä.

---

## 5. –ó–∞–º–µ—á–∞–Ω–∏—è –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

- **–ù–µ –∫–æ–º–º–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π BOT_TOKEN –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.**
- –ù–µ –≤—ã–∫–ª–∞–¥—ã–≤–∞–π `.env`, `.db` –∏ –∏—Å—Ö–æ–¥–Ω—ã–µ Excel —Å —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.
- –î–ª—è SSH –∏ GHCR –∏—Å–ø–æ–ª—å–∑—É–π –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã/–∫–ª—é—á–∏ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏.

---

–ï—Å–ª–∏ –∑–∞—Ö–æ—á–µ—à—å ‚Äî –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≤—Ç–æ—Ä—É—é workflow‚Äë—Å—Ö–µ–º—É:
–æ–¥–∏–Ω pipeline —Ç–æ–ª—å–∫–æ —Ç–µ—Å—Ç—ã/—Å–±–æ—Ä–∫–∞, –≤—Ç–æ—Ä–æ–π —Ç–æ–ª—å–∫–æ –¥–µ–ø–ª–æ–π –ø–æ –∫–Ω–æ–ø–∫–µ (`workflow_dispatch`).

